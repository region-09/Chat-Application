<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
</head>
<!-- TODO: user is clickable! -->
<body style="background-color: aquamarine;">
    {% csrf_token %}
    <div class="container">
        <h1 style="text-align: center;">Friend requests:</h1>
        <ul class="list-unstyled mb-0" style="background-color: aliceblue;" id="main">
            {% for request in requests %}
                <li class="p-2 border-bottom" id="{{request.from_user}}">
                    <div class="d-flex justify-content-between">
                        <div class="d-flex flex-row">
                            <img src={{request.from_user.profile_image}} alt="avatar"
                                class="rounded-circle d-flex align-self-center me-3 shadow-1-strong" width="50">
                            <div class="pt-1">
                                <p class="fw-bold mb-0 pt-2">{{request.from_user}}</p>
                            </div>
                        </div>
                        <div class="pt-2">
                            <button class="btn btn-primary" onclick="add_friend(event)">Add to friends</button>
                            <button class="btn btn-secondary" onclick="remove_request(event)">Remove</button>
                        </div>
                    </div>
                </li>
            {% endfor %}
        </ul>
    </div>
</body>

<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

<script>
    function add_friend(event) {
        console.log('here');
        var csrfToken = $('[name=csrfmiddlewaretoken]').val();
        const li_to_delete = event.target.parentNode.parentNode.parentNode;
        $.ajax({
            type: 'POST',
            url: "",  // Replace with your actual endpoint
            headers: {
                'X-CSRFToken': csrfToken
            },
            data: {
                from_user: li_to_delete.id,
                command: "add",
            },
            success: function (data) {
                console.log('Success! Clicked');
                // Add logic to update UI if needed
                // For example, change the like button appearance or count
            },
            error: function (error) {
                console.error('Error:', error);
            }
        });
        const main = document.getElementById('main');
        main.removeChild(li_to_delete); 
    }
    function remove_request(event) {
        var csrfToken = $('[name=csrfmiddlewaretoken]').val();
        const li_to_delete = event.target.parentNode.parentNode.parentNode;
        $.ajax({
            type: 'POST',
            url: "",  // Replace with your actual endpoint
            headers: {
                'X-CSRFToken': csrfToken
            },
            data: {
                from_user: li_to_delete.id,
                command: "remove",
            },
            success: function (data) {
                console.log('Success! Clicked');
                // Add logic to update UI if needed
                // For example, change the like button appearance or count
            },
            error: function (error) {
                console.error('Error:', error);
            }
        });
        const main = document.getElementById('main');
        main.removeChild(li_to_delete); 
    }
</script>

</html>